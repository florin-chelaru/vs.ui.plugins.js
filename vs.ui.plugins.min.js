(function(){/*
 vs.ui.plugins.js
 Copyright (c) 2015 Florin Chelaru
 License: MIT

 Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to
 permit persons to whom the Software is furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
'use strict';var t=this;Math.random();function A(c,g){var b=c.split("."),a=t;b[0]in a||!a.execScript||a.execScript("var "+b[0]);for(var r;b.length&&(r=b.shift());)b.length||void 0===g?a[r]?a=a[r]:a=a[r]={}:a[r]=g}function B(c,g){function b(){}b.prototype=g.prototype;c.l=g.prototype;c.prototype=new b;c.prototype.constructor=c;c.j=function(a,b,c){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return g.prototype[b].apply(a,d)}};var vs={ui:{}};u.extend(vs,this.vs);u.extend(vs.ui,this.vs.ui);vs.ui.plugins={};vs.ui.plugins.svg={};function F(){vs.ui.svg.SvgVis.apply(this,arguments)}B(F,vs.ui.svg.SvgVis);
var G=u.extend({},vs.ui.VisHandler.Settings,{xVal:vs.ui.Setting.PredefinedSettings.xVal,yVal:vs.ui.Setting.PredefinedSettings.yVal,xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries,yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries,xScale:vs.ui.Setting.PredefinedSettings.xScale,yScale:vs.ui.Setting.PredefinedSettings.yScale,cols:vs.ui.Setting.PredefinedSettings.cols,itemRatio:new vs.ui.Setting({key:"itemRatio",type:vs.ui.Setting.Type.NUMBER,defaultValue:.015,label:"item ratio",template:"_number.html"}),
fills:vs.ui.Setting.PredefinedSettings.fills,fillOpacity:vs.ui.Setting.PredefinedSettings.fillOpacity,strokes:vs.ui.Setting.PredefinedSettings.strokes,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});Object.defineProperties(F.prototype,{settings:{get:function(){return G}}});
F.prototype.endDraw=function(){var c=this,g=arguments;return(new Promise(function(b){var a=c.data,r=c.optionValue("cols"),a=a.filter(function(a){return 0<=r.indexOf(a.id)});if(a.length&&vs.models.DataSource.allDataIsReady(a)){var k=c.optionValue("margins"),d=c.optionValue("xScale"),e=c.optionValue("yScale"),f=c.optionValue("xVal"),y=c.optionValue("yVal"),g=c.optionValue("fills"),p=c.optionValue("fillOpacity"),l=c.optionValue("strokes"),q=c.optionValue("strokeThickness"),m=c.optionValue("itemRatio"),
h=c.optionValue("width"),n=c.optionValue("height"),m=Math.min(Math.abs(h),Math.abs(n))*m,n=d3.select(c.$element[0]).select("svg"),h=n.select(".viewport");h.empty()&&(h=n.append("g").attr("class","viewport"));h.attr("transform","translate("+k.left+", "+k.top+")");a=a.map(function(a){return a.d}).reduce(function(a,b){return a.concat(b)});a=h.selectAll("circle").data(a,JSON.stringify);a.enter().append("circle").attr("class","vs-item");a.attr("r",m).attr("cx",function(a){return d(parseFloat(a[f]))}).attr("cy",
function(a){return e(parseFloat(a[y]))}).attr("fill",function(a){return u.hex2rgba(g(a.__d__),p)}).style("stroke",function(a){return l([a.__d__])}).style("stroke-width",q);a.exit().remove()}b()})).then(function(){return vs.ui.svg.SvgVis.prototype.endDraw.apply(c,g)})};F.prototype.highlightItem=function(){};F.prototype.unhighlightItem=function(){};vs.ui.plugins.canvas={};
vs.ui.plugins.canvas.c=function(){function c(){vs.ui.canvas.CanvasVis.apply(this,arguments);this[g]=null}var g=Symbol("_quadTree");B(c,vs.ui.canvas.CanvasVis);c.f=u.extend({},vs.ui.canvas.CanvasVis.Settings,{xVal:vs.ui.Setting.PredefinedSettings.xVal,yVal:vs.ui.Setting.PredefinedSettings.yVal,xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries,yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries,xScale:vs.ui.Setting.PredefinedSettings.xScale,yScale:vs.ui.Setting.PredefinedSettings.yScale,cols:vs.ui.Setting.PredefinedSettings.cols,
itemRatio:new vs.ui.Setting({key:"itemRatio",type:vs.ui.Setting.Type.NUMBER,defaultValue:.015,label:"item ratio",template:"_number.html"}),fills:vs.ui.Setting.PredefinedSettings.fills,fillOpacity:vs.ui.Setting.PredefinedSettings.fillOpacity,strokes:vs.ui.Setting.PredefinedSettings.strokes,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});
Object.defineProperties(c.prototype,{settings:{get:function(){return c.f}}});c.prototype.beginDraw=function(){var b=this,a=arguments;return new Promise(function(c){vs.ui.canvas.CanvasVis.prototype.beginDraw.apply(b,a).then(function(){var a=b.data,d=b.optionValue("cols"),a=a.filter(function(a){return 0<=d.indexOf(a.id)});if(a.length&&vs.models.DataSource.allDataIsReady(a)){var e=b.optionValue("margins"),f=b.optionValue("xScale"),y=b.optionValue("yScale"),w=b.optionValue("xVal"),p=b.optionValue("yVal"),
l=b.optionValue("itemRatio"),q=b.optionValue("width"),m=b.optionValue("height"),h=Math.min(Math.abs(q),Math.abs(m))*l,n=new u.QuadTree(e.left,e.top,q-e.left-e.right,m-e.top-e.bottom,l,10),v=vs.models.Transformer.scale(f,y).translate({x:e.left,y:e.top});a.map(function(a){return a.d}).reduce(function(a,b){return a.concat(b)}).forEach(function(a){var b=v.calc({x:parseFloat(a[w]),y:parseFloat(a[p])});n.insert(b.x-h,b.y-h,2*h,2*h,a)});b[g]=n}c()})})};c.prototype.endDraw=function(){var b=this,a=arguments;
return(new Promise(function(a,c){var d=b.data,e=b.optionValue("cols"),d=d.filter(function(a){return 0<=e.indexOf(a.id)});if(d.length&&vs.models.DataSource.allDataIsReady(d)){var f=b.optionValue("margins"),g=b.optionValue("xScale"),w=b.optionValue("yScale"),p=b.optionValue("xVal"),l=b.optionValue("yVal"),q=b.optionValue("itemRatio"),m=b.optionValue("width"),h=b.optionValue("height"),n=Math.min(Math.abs(m),Math.abs(h))*q,v=b.optionValue("fills"),x=b.optionValue("fillOpacity"),z=b.optionValue("strokes"),
C=b.optionValue("strokeThickness"),D=b.pendingCanvas[0].getContext("2d"),E=vs.models.Transformer.scale(g,w).translate({x:f.left,y:f.top}),d=d.map(function(a){return a.d}).reduce(function(a,b){return a.concat(b)});u.async.each(d,function(a){return new Promise(function(b){setTimeout(function(){var c=E.calc({x:parseFloat(a[p]),y:parseFloat(a[l])});vs.ui.canvas.CanvasVis.circle(D,c.x,c.y,n,u.hex2rgba(v(a.__d__),x),z(a.__d__),C);b()},0)})}).then(a,c)}else a()})).then(function(){return vs.ui.canvas.CanvasVis.prototype.endDraw.apply(b,
a)})};c.prototype.getItemsAt=function(){return[]};c.prototype.highlightItem=function(){};return c}();vs.ui.plugins.canvas.a=function(){function c(){vs.ui.canvas.CanvasVis.apply(this,arguments);this[b]=null;this[g]=null;var a=this;this.$scope.$watch(function(){return{cols:a.options.cols,xVal:a.options.xVal,mergeCols:a.options.mergeCols}},function(){a.schedulePreProcessData().then(function(){a.scheduleRedraw()})},!0)}var g=Symbol("_quadTree"),b=Symbol("_merged");B(c,vs.ui.canvas.CanvasVis);c.i=function(a,b,c,d){var e=["yBoundaries","width","margins"];if(!d)throw new vs.ui.UiException('Settings not provided for "xScale", which depends on '+
JSON.stringify(e));e.forEach(function(a){if(!(a in d))throw new vs.ui.UiException('Missing dependency for "'+a+'" in the "xScale" defaultValue function');});var e=d.yBoundaries.getValue(a,b,c,d),f=d.width.getValue(a,b,c,d);a=d.margins.getValue(a,b,c,d);return d3.scale.linear().domain([e.min,e.max]).range([0,f-a.left-a.right])};c.f=u.extend({},vs.ui.canvas.CanvasVis.Settings,{xVal:vs.ui.Setting.PredefinedSettings.xVal,yVal:vs.ui.Setting.PredefinedSettings.yVal,xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries,
yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries,xScale:new vs.ui.Setting({key:"xScale",type:vs.ui.Setting.Type.FUNCTION,defaultValue:c.i,hidden:!0}),yScale:vs.ui.Setting.PredefinedSettings.yScale,cols:vs.ui.Setting.PredefinedSettings.cols,mergeCols:vs.ui.Setting.PredefinedSettings.mergeCols,vals:new vs.ui.Setting({key:"vals",type:vs.ui.Setting.Type.DATA_ROW_LABEL,defaultValue:vs.ui.Setting.firstRowsLabel,label:"values",template:"_categorical.html"}),itemRatio:new vs.ui.Setting({key:"itemRatio",
type:vs.ui.Setting.Type.NUMBER,defaultValue:.015,label:"item ratio",template:"_number.html"}),fill:vs.ui.Setting.PredefinedSettings.fill,stroke:vs.ui.Setting.PredefinedSettings.stroke,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});Object.defineProperties(c.prototype,{settings:{get:function(){return c.f}}});
c.prototype.beginDraw=function(){var a=this,c=arguments;return new Promise(function(k){vs.ui.canvas.CanvasVis.prototype.beginDraw.apply(a,c).then(function(){var c=a[b];if(c&&c.d.length){var e=a.optionValue("cols"),f=a.optionValue("margins");a.optionValue("xVal");var r=a.optionValue("yVal"),w=a.optionValue("itemRatio"),p=a.optionValue("xScale"),l=a.optionValue("yScale"),q=a.optionValue("width"),m=a.optionValue("height"),h=Math.min(Math.abs(q),Math.abs(m))*w,n=e[0],v=e[1],x=new u.QuadTree(f.left,f.top,
q-f.left-f.right,m-f.top-f.bottom,w,10),z=vs.models.Transformer.scale(p,l).translate({x:f.left,y:f.top});c.d.forEach(function(a){var b=z.calc({x:a[n][r],y:a[v][r]});x.insert(b.x-h,b.y-h,2*h,2*h,a)});a[g]=x}k()})})};c.prototype.endDraw=function(){var a=this,c=arguments;return(new Promise(function(c,d){var e=a[b];if(e&&e.d.length){var f=a.optionValue("margins"),g=a.optionValue("xScale"),r=a.optionValue("yScale"),p=a.optionValue("cols");a.optionValue("xVal");var l=a.optionValue("yVal"),q=a.optionValue("itemRatio"),
m=a.optionValue("width"),h=a.optionValue("height"),n=Math.min(Math.abs(m),Math.abs(h))*q,v=p[0],x=p[1],z=a.optionValue("fill"),C=a.optionValue("stroke"),D=a.optionValue("strokeThickness"),E=a.pendingCanvas[0].getContext("2d"),H=vs.models.Transformer.scale(g,r).translate({x:f.left,y:f.top});u.async.each(e.d,function(a){return new Promise(function(b){setTimeout(function(){var c=H.calc({x:a[v][l],y:a[x][l]});vs.ui.canvas.CanvasVis.circle(E,c.x,c.y,n,z,C,D);b()},0)})}).then(c,d)}else c()})).then(function(){return vs.ui.canvas.CanvasVis.prototype.endDraw.apply(a,
c)})};c.prototype.getItemsAt=function(){return[]};c.prototype.highlightItem=function(){};c.prototype.preProcessData=function(){var a=this;return new Promise(function(c,k){Promise.all(a.data.map(function(a){return a.ready})).then(function(){var d=a.optionValue("cols"),e=a.optionValue("xVal"),f=d.map(function(b){return a.data[u.array.indexOf(a.data,function(a){return a.id==b})]});2>f.length?k("Scatter plot needs two columns of data, but only received "+d.length):(d=a.optionValue("mergeCols"),a[b]=d(f[0],
f[1],e),c())})})};return c}();vs.ui.plugins.svg.a=function(){function c(){vs.ui.svg.SvgVis.apply(this,arguments);this[g]=null;var b=this;this.$scope.$watch(function(){return{cols:b.options.cols,xVal:b.options.xVal,mergeCols:b.options.mergeCols}},function(){b.schedulePreProcessData().then(function(){b.scheduleRedraw()})},!0)}var g=Symbol("_merged");B(c,vs.ui.svg.SvgVis);c.i=function(b,a,c,k){var d=["yBoundaries","width","margins"];if(!k)throw new vs.ui.UiException('Settings not provided for "xScale", which depends on '+JSON.stringify(d));
d.forEach(function(a){if(!(a in k))throw new vs.ui.UiException('Missing dependency for "'+a+'" in the "xScale" defaultValue function');});var d=k.yBoundaries.getValue(b,a,c,k),e=k.width.getValue(b,a,c,k);b=k.margins.getValue(b,a,c,k);return d3.scale.linear().domain([d.min,d.max]).range([0,e-b.left-b.right])};c.f=u.extend({},vs.ui.VisHandler.Settings,{xVal:vs.ui.Setting.PredefinedSettings.xVal,yVal:vs.ui.Setting.PredefinedSettings.yVal,xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries,yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries,
xScale:new vs.ui.Setting({key:"xScale",type:vs.ui.Setting.Type.FUNCTION,defaultValue:c.i,hidden:!0}),yScale:vs.ui.Setting.PredefinedSettings.yScale,cols:vs.ui.Setting.PredefinedSettings.cols,mergeCols:vs.ui.Setting.PredefinedSettings.mergeCols,vals:new vs.ui.Setting({key:"vals",type:vs.ui.Setting.Type.DATA_ROW_LABEL,defaultValue:vs.ui.Setting.firstRowsLabel,label:"values",template:"_categorical.html"}),itemRatio:new vs.ui.Setting({key:"itemRatio",type:vs.ui.Setting.Type.NUMBER,defaultValue:.015,label:"item ratio",
template:"_number.html"}),fill:vs.ui.Setting.PredefinedSettings.fill,stroke:vs.ui.Setting.PredefinedSettings.stroke,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});Object.defineProperties(c.prototype,{settings:{get:function(){return c.f}}});c.prototype.endDraw=function(){var b=this,a=arguments;
return(new Promise(function(a){var c=b[g];if(c&&c.d.length){var d=b.optionValue("cols"),e=b.optionValue("margins"),f=b.optionValue("xScale"),y=b.optionValue("yScale");b.optionValue("xVal");var w=b.optionValue("yVal"),p=b.optionValue("itemRatio"),l=b.optionValue("width"),q=b.optionValue("height"),m=b.optionValue("fill"),h=b.optionValue("stroke"),n=b.optionValue("strokeThickness"),p=Math.min(Math.abs(l),Math.abs(q))*p,v=d[0],x=d[1],l=d3.select(b.$element[0]).select("svg"),d=l.select(".viewport");d.empty()&&
(d=l.append("g").attr("class","viewport"));d.attr("transform","translate("+e.left+", "+e.top+")");c=c.d;c=d.selectAll("circle").data(c,JSON.stringify);c.enter().append("circle").attr("class","vs-item");c.attr("r",p).attr("cx",function(a){return f(a[v][w])}).attr("cy",function(a){return y(a[x][w])}).attr("fill",m).style("stroke",h).style("stroke-width",n);c.exit().remove()}a()})).then(function(){return vs.ui.svg.SvgVis.prototype.endDraw.apply(b,a)})};c.prototype.highlightItem=function(){};c.prototype.unhighlightItem=
function(){};c.prototype.preProcessData=function(){var b=this;return new Promise(function(a,c){Promise.all(b.data.map(function(a){return a.ready})).then(function(){var k=b.optionValue("cols"),d=b.optionValue("xVal"),e=k.map(function(a){return b.data[u.array.indexOf(b.data,function(b){return b.id==a})]});2>e.length?c("Scatter plot needs two columns of data, but only received "+k.length):(k=b.optionValue("mergeCols"),b[g]=k(e[0],e[1],d),a())})})};return c}();A("vs.ui.plugins.canvas.ManhattanPlot",vs.ui.plugins.canvas.c);vs.ui.plugins.canvas.c.prototype.endDraw=vs.ui.plugins.canvas.c.prototype.endDraw;vs.ui.plugins.canvas.c.prototype.getItemsAt=vs.ui.plugins.canvas.c.prototype.getItemsAt;vs.ui.plugins.canvas.c.prototype.highlightItem=vs.ui.plugins.canvas.c.prototype.highlightItem;A("vs.ui.plugins.canvas.ScatterPlot",vs.ui.plugins.canvas.a);vs.ui.plugins.canvas.a.prototype.endDraw=vs.ui.plugins.canvas.a.prototype.endDraw;vs.ui.plugins.canvas.a.prototype.getItemsAt=vs.ui.plugins.canvas.a.prototype.getItemsAt;vs.ui.plugins.canvas.a.prototype.highlightItem=vs.ui.plugins.canvas.a.prototype.highlightItem;A("vs.ui.plugins.svg.ManhattanPlot",F);F.prototype.endDraw=F.prototype.endDraw;F.prototype.highlightItem=F.prototype.highlightItem;F.prototype.unhighlightItem=F.prototype.unhighlightItem;A("vs.ui.plugins.svg.ScatterPlot",vs.ui.plugins.svg.a);vs.ui.plugins.svg.a.prototype.endDraw=vs.ui.plugins.svg.a.prototype.endDraw;vs.ui.plugins.svg.a.prototype.highlightItem=vs.ui.plugins.svg.a.prototype.highlightItem;vs.ui.plugins.svg.a.prototype.unhighlightItem=vs.ui.plugins.svg.a.prototype.unhighlightItem;}).call(this); //@ sourceMappingURL=vs.ui.plugins.min.js.map
