(function(){/*
 vs.ui.plugins.js
 Copyright (c) 2015 Florin Chelaru
 License: MIT

 Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to
 permit persons to whom the Software is furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
'use strict';var y=this;Math.random();function z(b,g){var h=b.split("."),a=y;h[0]in a||!a.execScript||a.execScript("var "+h[0]);for(var k;h.length&&(k=h.shift());)h.length||void 0===g?a[k]?a=a[k]:a=a[k]={}:a[k]=g}function C(b,g){function h(){}h.prototype=g.prototype;b.B=g.prototype;b.prototype=new h;b.prototype.constructor=b;b.v=function(a,h,d){for(var b=Array(arguments.length-2),c=2;c<arguments.length;c++)b[c-2]=arguments[c];return g.prototype[h].apply(a,b)}};var vs={ui:{}};u.extend(vs,this.vs);u.extend(vs.ui,this.vs.ui);vs.ui.plugins={};vs.ui.plugins.canvas={};
vs.ui.plugins.canvas.c=function(){function b(){vs.ui.canvas.CanvasVis.apply(this,arguments);this[h]=null;this[g]=null;var a=this;this.$scope.$watch(function(){return{xyFields:a.options.xyFields,mergeField:a.options.mergeField,mergeCols:a.options.mergeCols}},function(){a.schedulePreProcessData().then(function(){a.scheduleRedraw()})},!0)}var g=Symbol("_quadTree"),h=Symbol("_merged");C(b,vs.ui.canvas.CanvasVis);b.A=function(a,h,d,b){var c=["yBoundaries","width","margins"];if(!b)throw new vs.ui.UiException('Settings not provided for "xScale", which depends on '+
JSON.stringify(c));u.fast.forEach(c,function(a){if(!(a in b))throw new vs.ui.UiException('Missing dependency for "'+a+'" in the "xScale" defaultValue function');});var c=b.yBoundaries.getValue(a,h,d,b),e=b.width.getValue(a,h,d,b);a=b.margins.getValue(a,h,d,b);return d3.scale.linear().domain([c.min,c.max]).range([0,e-a.left-a.right])};b.a=u.extend({},vs.ui.canvas.CanvasVis.Settings,{mergeField:new vs.ui.Setting({key:"mergeField",type:vs.ui.Setting.Type.DATA_ROW_LABEL,defaultValue:vs.ui.Setting.firstRowsLabel,
label:"merge field",template:"_categorical.html"}),valueField:vs.ui.Setting.PredefinedSettings.yField.copy({key:"valueField",label:"value field"}),xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries.copy({dependencies:{xField:"valueField"}}),yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries.copy({dependencies:{yField:"valueField"}}),xScale:vs.ui.Setting.PredefinedSettings.xScale,yScale:vs.ui.Setting.PredefinedSettings.yScale,xyFields:vs.ui.Setting.PredefinedSettings.cols.copy({key:"xyFields",
label:"x/y fields",defaultValue:function(a,h,b,f){return u.fast.map(f.slice(0,2),function(a){return a.id})}}),xLabel:new vs.ui.Setting({key:"xLabel",type:vs.ui.Setting.Type.STRING,defaultValue:b.j,label:"x label",dependencies:{xyFields:"xyFields"},template:"_string.html"}),yLabel:new vs.ui.Setting({key:"yLabel",type:vs.ui.Setting.Type.STRING,defaultValue:b.o,label:"y label",dependencies:{xyFields:"xyFields"},template:"_string.html"}),mergeFields:vs.ui.Setting.PredefinedSettings.mergeCols.copy({key:"mergeFields",
dependencies:{xCol:"mergeField"}}),itemRatio:new vs.ui.Setting({key:"itemRatio",type:vs.ui.Setting.Type.NUMBER,defaultValue:.015,label:"item ratio",template:"_slider.html",possibleValues:{min:.001,max:.1,step:.001}}),fill:vs.ui.Setting.PredefinedSettings.fill,stroke:vs.ui.Setting.PredefinedSettings.stroke,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});
Object.defineProperties(b.prototype,{settings:{get:function(){return b.a}}});b.prototype.beginDraw=function(){var a=this,b=arguments;return new Promise(function(d){vs.ui.canvas.CanvasVis.prototype.beginDraw.apply(a,b).then(function(){var b=a[h];if(b&&b.d.length){var c=a.optionValue("xyFields"),e=a.optionValue("margins"),k=a.optionValue("yBoundaries");a.optionValue("mergeField");for(var p=a.optionValue("valueField"),l=a.optionValue("itemRatio"),m=a.optionValue("xScale"),t=a.optionValue("yScale"),n=
a.optionValue("width"),q=a.optionValue("height"),r=Math.min(Math.abs(n),Math.abs(q))*l,v=c[0],c=c[1],l=new u.QuadTree(e.left,e.top,n-e.left-e.right,q-e.top-e.bottom,l,10),e=vs.models.Transformer.scale(m,t).translate({x:e.left,y:e.top}),b=b.d,m=0;m<b.length;++m)t=b[m],n=e.calc({x:void 0!=t[v]?t[v][p]:k.min,y:void 0!=t[c]?t[c][p]:k.min}),l.insert(n.x-r,n.y-r,2*r,2*r,t);a[g]=l}d()})})};b.prototype.endDraw=function(){var a=this,b=arguments;return(new Promise(function(b,k){var c=a[h];if(c&&c.d.length){var e=
a.optionValue("margins"),w=a.optionValue("xScale"),p=a.optionValue("yScale"),l=a.optionValue("xyFields"),m=a.optionValue("yBoundaries");a.optionValue("mergeField");var g=a.optionValue("valueField"),n=a.optionValue("itemRatio"),q=a.optionValue("width"),r=a.optionValue("height"),v=Math.min(Math.abs(q),Math.abs(r))*n,x=l[0],A=l[1],B=a.optionValue("fill"),F=a.optionValue("stroke"),E=a.optionValue("strokeThickness"),G=a.pendingCanvas[0].getContext("2d"),I=vs.models.Transformer.scale(w,p).translate({x:e.left,
y:e.top});u.async.each(c.d,function(a){return new Promise(function(b){setTimeout(function(){var h=I.calc({x:void 0!=a[x]?a[x][g]:m.min,y:void 0!=a[A]?a[A][g]:m.min});vs.ui.canvas.CanvasVis.circle(G,h.x,h.y,v,void 0==a[x]||void 0==a[A]?"rgba(170,170,170,0.5)":B,void 0==a[x]||void 0==a[A]?"rgb(170,170,170)":F,E);b()},0)})}).then(b,k)}else b()})).then(function(){return vs.ui.canvas.CanvasVis.prototype.endDraw.apply(a,b)})};b.prototype.getItemsAt=function(a,b){console.log(a,b);if(!this[g])return[];var h=
this.optionValue("xyFields"),f=h[0],c=h[1];return u.fast.concat(u.fast.map(this[g].collisions(a,b),function(a){var b=[];void 0!=a.value[f]&&b.push(a.value[f]);void 0!=a.value[c]&&b.push(a.value[c]);return b}))};b.prototype.highlightItem=function(a,b){if(this.brushingCanvas&&b.length){var d=this[h];if(d){var f=this.optionValue("mergeField"),c=u.mapToObject(b,function(a){return{key:a[f],value:!0}}),d=u.fast.filter(d.d,function(a){return a[f]in c});if(d.length){var e=this.optionValue("margins"),w=this.optionValue("xScale"),
g=this.optionValue("yScale"),l=this.optionValue("xyFields"),m=this.optionValue("valueField"),t=this.optionValue("itemRatio"),n=this.optionValue("width"),q=this.optionValue("height"),r=this.optionValue("yBoundaries"),v=this.optionValue("selectFill"),x=this.optionValue("selectStroke"),A=this.optionValue("selectStrokeThickness"),B=vs.models.Transformer.scale(w,g).translate({x:e.left,y:e.top}),F=Math.min(Math.abs(n),Math.abs(q))*t,E=l[0],G=l[1],I=this.brushingCanvas[0].getContext("2d");this.brushingCanvas.attr({width:n,
height:q});u.fast.forEach(d,function(a){a=B.calc({x:void 0!=a[E]?a[E][m]:r.min,y:void 0!=a[G]?a[G][m]:r.min});vs.ui.canvas.CanvasVis.circle(I,a.x,a.y,F,v,x,A)});this.brushingCanvas.css("display","block")}}}};b.prototype.unhighlightItem=function(){this.brushingCanvas.css("display","none");var a=this.optionValue("width"),b=this.optionValue("height");this.brushingCanvas[0].getContext("2d").clearRect(0,0,a,b)};b.prototype.preProcessData=function(){var a=this;return new Promise(function(b,d){Promise.all(u.fast.map(a.data,
function(a){return a.ready})).then(function(){var f=a.optionValue("xyFields"),c=a.optionValue("mergeField"),e=u.fast.map(f,function(b){return a.data[u.array.indexOf(a.data,function(a){return a.id==b})]});2>e.length?d("Scatter plot needs two columns of data, but only received "+f.length):(f=a.optionValue("mergeFields"),a[h]=f(c,e),b())})})};return b}();vs.ui.plugins.svg={};
vs.ui.plugins.svg.c=function(){function b(){vs.ui.svg.SvgVis.apply(this,arguments);this[g]=null;var b=this;this.$scope.$watch(function(){return{cols:b.options.cols,mergeField:b.options.mergeField,mergeFields:b.options.mergeFields}},function(){b.schedulePreProcessData().then(function(){b.scheduleRedraw()})},!0)}var g=Symbol("_merged");C(b,vs.ui.svg.SvgVis);b.j=function(b,a,k,d,f){var c=b.dependencies;if(!f)throw new vs.ui.UiException('Settings not provided for "'+b.key+'", which depends on '+JSON.stringify(c));
u.each(c,function(a,b){if(!(b in f))throw new vs.ui.UiException('Missing dependency for "'+b+'" in the "xLabel" defaultValue function');});return f[c.xyFields].getValue(a,k,d,f)[0]};b.o=function(b,a,k,d,f){var c=b.dependencies;if(!f)throw new vs.ui.UiException('Settings not provided for "'+b.key+'", which depends on '+JSON.stringify(c));u.each(c,function(a,b){if(!(b in f))throw new vs.ui.UiException('Missing dependency for "'+b+'" in the "xLabel" defaultValue function');});return f[c.xyFields].getValue(a,
k,d,f)[1]};b.a=u.extend({},vs.ui.VisHandler.Settings,{mergeField:new vs.ui.Setting({key:"mergeField",type:vs.ui.Setting.Type.DATA_ROW_LABEL,defaultValue:vs.ui.Setting.firstRowsLabel,label:"merge field",template:"_categorical.html"}),valueField:vs.ui.Setting.PredefinedSettings.yField.copy({key:"valueField",label:"value field"}),xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries.copy({dependencies:{xField:"valueField"}}),yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries.copy({dependencies:{yField:"valueField"}}),
xScale:vs.ui.Setting.PredefinedSettings.xScale,yScale:vs.ui.Setting.PredefinedSettings.yScale,xyFields:vs.ui.Setting.PredefinedSettings.cols.copy({key:"xyFields",label:"x/y fields",defaultValue:function(b,a,k,d){return u.fast.map(d.slice(0,2),function(a){return a.id})}}),xLabel:new vs.ui.Setting({key:"xLabel",type:vs.ui.Setting.Type.STRING,defaultValue:b.j,label:"x label",dependencies:{xyFields:"xyFields"},template:"_string.html"}),yLabel:new vs.ui.Setting({key:"yLabel",type:vs.ui.Setting.Type.STRING,
defaultValue:b.o,label:"y label",dependencies:{xyFields:"xyFields"},template:"_string.html"}),mergeFields:vs.ui.Setting.PredefinedSettings.mergeCols.copy({key:"mergeFields",dependencies:{xCol:"mergeField"}}),itemRatio:new vs.ui.Setting({key:"itemRatio",type:vs.ui.Setting.Type.NUMBER,defaultValue:.015,label:"item ratio",template:"_slider.html",possibleValues:{min:.001,max:.1,step:.001}}),fill:vs.ui.Setting.PredefinedSettings.fill,stroke:vs.ui.Setting.PredefinedSettings.stroke,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,
selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});Object.defineProperties(b.prototype,{settings:{get:function(){return b.a}}});b.prototype.endDraw=function(){var b=this,a=arguments;return(new Promise(function(a){var d=b[g];if(d&&d.d.length){var f=b.optionValue("xyFields"),c=f[0],e=f[1],w=b.optionValue("margins"),p=b.optionValue("yBoundaries"),l=b.a("xScale"),
m=b.a("yScale"),t=b.optionValue("mergeField"),n=b.optionValue("valueField"),q=b.optionValue("itemRatio"),r=b.optionValue("width"),v=b.optionValue("height"),x=b.optionValue("fill"),A=b.optionValue("stroke"),f=b.optionValue("strokeThickness"),q=Math.min(Math.abs(r),Math.abs(v))*q,v=d3.select(b.$element[0]).select("svg"),r=v.select(".viewport");r.empty()&&(r=v.append("g").attr("class","viewport"));r.attr("transform","translate("+w.left+", "+w.top+")");var d=d.d,d=r.selectAll("circle").data(d,function(a){return a[t]}),
B=u.mapToObject(b.data,function(a){return{key:a.id,value:a}});d.enter().append("circle").attr("class","vs-item").on("mouseover",function(a){a[c]&&b.brushing.fire(new vs.ui.BrushingEvent(B[c],vs.ui.BrushingEvent.Action.MOUSEOVER,a[c]));a[e]&&b.brushing.fire(new vs.ui.BrushingEvent(B[e],vs.ui.BrushingEvent.Action.MOUSEOVER,a[e]))}).on("mouseout",function(a){a[c]&&b.brushing.fire(new vs.ui.BrushingEvent(B[c],vs.ui.BrushingEvent.Action.MOUSEOUT,a[c]));a[e]&&b.brushing.fire(new vs.ui.BrushingEvent(B[e],
vs.ui.BrushingEvent.Action.MOUSEOUT,a[e]))}).on("click",function(){d3.event.stopPropagation()});d.attr("r",q).attr("cx",function(a){return l(void 0!=a[c]?a[c][n]:p.min)}).attr("cy",function(a){return m(void 0!=a[e]?a[e][n]:p.min)}).style("fill",function(a){return void 0==a[c]||void 0==a[e]?"rgba(170,170,170,0.5)":x}).style("stroke",function(a){return void 0==a[c]||void 0==a[e]?"rgb(170,170,170)":A}).style("stroke-width",f);d.exit().remove()}a()})).then(function(){return vs.ui.svg.SvgVis.prototype.endDraw.apply(b,
a)})};b.prototype.highlightItem=function(b,a){var k=d3.select(this.$element[0]).select("svg").select(".viewport");if(!k.empty()&&a.length){var d=this.optionValue("mergeField"),f=u.mapToObject(a,function(a){return{key:a[d],value:!0}}),c=k.selectAll(".vs-item").filter(function(a){return a[d]in f});if(!c.empty()){var e=this.optionValue("selectFill"),w=this.optionValue("selectStroke"),g=this.optionValue("selectStrokeThickness");c.style("fill",e).style("stroke",w).style("stroke-width",g);$(c[0]).appendTo($(k))}}};
b.prototype.unhighlightItem=function(b,a){var k=d3.select(this.$element[0]).select("svg").select(".viewport");if(!k.empty()){var d=this.optionValue("mergeField"),f=u.mapToObject(a,function(a){return{key:a[d],value:!0}}),k=k.selectAll(".vs-item").filter(function(a){return a[d]in f});if(!k.empty()){var c=this.optionValue("fill"),e=this.optionValue("stroke"),w=this.optionValue("strokeThickness"),g=this.optionValue("xyFields"),l=g[0],m=g[1];k.style("stroke-width",w).style("fill",function(a){return void 0==
a[l]||void 0==a[m]?"rgba(170,170,170,0.5)":c}).style("stroke",function(a){return void 0==a[l]||void 0==a[m]?"rgb(170,170,170)":e})}}};b.prototype.preProcessData=function(){var b=this;return new Promise(function(a,k){Promise.all(u.fast.map(b.data,function(a){return a.ready})).then(function(){var d=b.optionValue("xyFields"),f=b.optionValue("mergeField"),c=u.fast.map(d,function(a){return b.data[u.array.indexOf(b.data,function(b){return b.id==a})]});2>c.length?k("Scatter plot needs two columns of data, but only received "+
d.length):(d=b.optionValue("mergeFields"),b[g]=d(f,c),a())})})};return b}();vs.ui.plugins.canvas.i=function(){function b(){vs.ui.canvas.CanvasVis.apply(this,arguments);this[g]=null}var g=Symbol("_quadTree");C(b,vs.ui.canvas.CanvasVis);b.a=u.extend({},vs.ui.canvas.CanvasVis.Settings,{xVal:vs.ui.Setting.PredefinedSettings.xVal,yVal:vs.ui.Setting.PredefinedSettings.yVal,xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries,yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries,xScale:vs.ui.Setting.PredefinedSettings.xScale,yScale:vs.ui.Setting.PredefinedSettings.yScale,
cols:vs.ui.Setting.PredefinedSettings.cols,itemRatio:new vs.ui.Setting({key:"itemRatio",type:vs.ui.Setting.Type.NUMBER,defaultValue:.015,label:"item ratio",template:"_number.html"}),fills:vs.ui.Setting.PredefinedSettings.fills,fillOpacity:vs.ui.Setting.PredefinedSettings.fillOpacity,strokes:vs.ui.Setting.PredefinedSettings.strokes,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,
selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});Object.defineProperties(b.prototype,{settings:{get:function(){return b.a}}});b.prototype.beginDraw=function(){var b=this,a=arguments;return new Promise(function(k){vs.ui.canvas.CanvasVis.prototype.beginDraw.apply(b,a).then(function(){var a=b.data,f=b.optionValue("cols"),a=a.filter(function(a){return 0<=f.indexOf(a.id)});if(a.length&&vs.models.DataSource.allDataIsReady(a)){for(var c=b.optionValue("margins"),e=b.optionValue("xScale"),
w=b.optionValue("yScale"),p=b.optionValue("xVal"),l=b.optionValue("yVal"),m=b.optionValue("itemRatio"),t=b.optionValue("width"),n=b.optionValue("height"),q=Math.min(Math.abs(t),Math.abs(n))*m,m=new u.QuadTree(c.left,c.top,t-c.left-c.right,n-c.top-c.bottom,m,10),c=vs.models.Transformer.scale(e,w).translate({x:c.left,y:c.top}),a=u.fast.concat(u.fast.map(a,function(a){return a.d})),e=0;e<a.length;++e)w=a[e],t=c.calc({x:parseFloat(w[p]),y:parseFloat(w[l])}),m.insert(t.x-q,t.y-q,2*q,2*q,w);b[g]=m}k()})})};
b.prototype.endDraw=function(){var b=this,a=arguments;return(new Promise(function(a,d){var f=b.optionValue("cols"),c=b.data.filter(function(a){return 0<=f.indexOf(a.id)});if(c.length&&vs.models.DataSource.allDataIsReady(c)){var e=b.optionValue("margins"),g=b.optionValue("xScale"),p=b.optionValue("yScale"),l=b.optionValue("xVal"),m=b.optionValue("yVal"),t=b.optionValue("itemRatio"),n=b.optionValue("width"),q=b.optionValue("height"),r=Math.min(Math.abs(n),Math.abs(q))*t,v=b.optionValue("fills"),x=b.optionValue("fillOpacity"),
A=b.optionValue("strokes"),B=b.optionValue("strokeThickness"),F=b.pendingCanvas[0].getContext("2d"),E=vs.models.Transformer.scale(g,p).translate({x:e.left,y:e.top}),c=u.fast.concat(u.fast.map(c,function(a){return a.d}));u.async.each(c,function(a){return new Promise(function(b){setTimeout(function(){var c=E.calc({x:parseFloat(a[l]),y:parseFloat(a[m])});vs.ui.canvas.CanvasVis.circle(F,c.x,c.y,r,u.hex2rgba(v(a.__d__),x),A(a.__d__),B);b()},0)})}).then(a,d)}else a()})).then(function(){return vs.ui.canvas.CanvasVis.prototype.endDraw.apply(b,
a)})};b.prototype.getItemsAt=function(b,a){return this[g]?u.fast.map(this[g].collisions(b,a),function(a){return a.value}):[]};b.prototype.highlightItem=function(b,a){if(this.brushingCanvas&&a.length){var k=this.optionValue("margins"),d=this.optionValue("xScale"),f=this.optionValue("yScale"),c=this.optionValue("cols"),e=this.optionValue("xVal"),g=this.optionValue("yVal"),p=this.optionValue("itemRatio"),l=this.optionValue("width"),m=this.optionValue("height"),p=Math.min(Math.abs(l),Math.abs(m))*p,t=
this.optionValue("selectFill"),n=this.optionValue("selectStroke"),q=this.optionValue("selectStrokeThickness"),r=u.mapToObject(c,function(a){return{key:a,value:!0}});a=a.filter(function(a){return a.__d__ in r});k=vs.models.Transformer.scale(d,f).translate({x:k.left,y:k.top});d=this.brushingCanvas[0].getContext("2d");this.brushingCanvas.attr({width:l,height:m});for(l=0;l<a.length;++l)m=a[l],m=k.calc({x:parseFloat(m[e]),y:m[g]}),vs.ui.canvas.CanvasVis.circle(d,m.x,m.y,p,t,n,q);this.brushingCanvas.css("display",
"block")}};b.prototype.unhighlightItem=function(){this.brushingCanvas.css("display","none");var b=this.optionValue("width"),a=this.optionValue("height");this.brushingCanvas[0].getContext("2d").clearRect(0,0,b,a)};return b}();function D(){vs.ui.svg.SvgVis.apply(this,arguments)}C(D,vs.ui.svg.SvgVis);
var H=u.extend({},vs.ui.VisHandler.Settings,{xField:vs.ui.Setting.PredefinedSettings.xField,yField:vs.ui.Setting.PredefinedSettings.yField,xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries,yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries,xScale:vs.ui.Setting.PredefinedSettings.xScale,yScale:vs.ui.Setting.PredefinedSettings.yScale,cols:vs.ui.Setting.PredefinedSettings.cols,itemRatio:new vs.ui.Setting({key:"itemRatio",type:vs.ui.Setting.Type.NUMBER,defaultValue:.015,label:"item ratio",
template:"_slider.html",possibleValues:{min:.001,max:.1,step:.001}}),fills:vs.ui.Setting.PredefinedSettings.fills,fillOpacity:vs.ui.Setting.PredefinedSettings.fillOpacity,strokes:vs.ui.Setting.PredefinedSettings.strokes,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});
Object.defineProperties(D.prototype,{settings:{get:function(){return H}}});
D.prototype.endDraw=function(){var b=this,g=arguments;return(new Promise(function(h){var a=b.data,k=b.optionValue("cols"),a=a.filter(function(a){return 0<=k.indexOf(a.id)});if(a.length&&vs.models.DataSource.allDataIsReady(a)){var d=b.optionValue("margins"),f=b.a("xScale"),c=b.a("yScale"),e=b.optionValue("xField"),g=b.optionValue("yField"),p=b.a("fills"),l=b.optionValue("fillOpacity"),m=b.a("strokes"),t=b.optionValue("strokeThickness"),n=b.optionValue("itemRatio"),q=b.optionValue("width"),r=b.optionValue("height"),
n=Math.min(Math.abs(q),Math.abs(r))*n,r=d3.select(b.$element[0]).select("svg"),q=r.select(".viewport");q.empty()&&(q=r.append("g").attr("class","viewport"));q.attr("transform","translate("+d.left+", "+d.top+")");var a=u.fast.concat(u.fast.map(a,function(a){return a.d})),a=q.selectAll("circle").data(a,J(b)),v=u.mapToObject(b.data,function(a){return{key:a.id,value:a}});a.enter().append("circle").attr("class","vs-item").on("mouseover",function(a){a&&b.brushing.fire(new vs.ui.BrushingEvent(v[a.__d__],
vs.ui.BrushingEvent.Action.MOUSEOVER,a))}).on("mouseout",function(a){a&&b.brushing.fire(new vs.ui.BrushingEvent(v[a.__d__],vs.ui.BrushingEvent.Action.MOUSEOUT,a))}).on("click",function(){d3.event.stopPropagation()});a.attr("r",n).attr("cx",function(a){return f(parseFloat(a[e]))}).attr("cy",function(a){return c(parseFloat(a[g]))}).style("fill",function(a){return u.hex2rgba(p(a.__d__),l)}).style("stroke",function(a){return m([a.__d__])}).style("stroke-width",t);a.exit().remove()}h()})).then(function(){return vs.ui.svg.SvgVis.prototype.endDraw.apply(b,
g)})};D.prototype.highlightItem=function(b,g){var h=d3.select(this.$element[0]).select("svg").select(".viewport");if(!h.empty()&&g.length){var a=J(this),k=u.mapToObject(g,function(b){return{key:a(b),value:!0}}),d=h.selectAll(".vs-item").filter(function(b){return a(b)in k});if(!d.empty()){var f=this.optionValue("selectFill"),c=this.optionValue("selectStroke"),e=this.optionValue("selectStrokeThickness");d.style("stroke",c).style("stroke-width",e).style("fill",f);$(d[0]).appendTo($(h[0]))}}};
D.prototype.unhighlightItem=function(b,g){var h=d3.select(this.$element[0]).select("svg").select(".viewport");if(!h.empty()){var a=J(this),k=u.mapToObject(g,function(b){return{key:a(b),value:!0}}),h=h.selectAll(".vs-item").filter(function(b){return a(b)in k});if(!h.empty()){var d=this.a("fills"),f=this.a("strokes"),c=this.optionValue("fillOpacity"),e=this.optionValue("strokeThickness");h.style("fill",function(a){return u.hex2rgba(d(a.__d__),c)}).style("stroke",function(a){return f([a.__d__])}).style("stroke-width",
e)}}};function J(b){var g=b.optionValue("xField");return function(b){return b.__d__+"-"+b[g]}};function K(){vs.ui.svg.SvgVis.apply(this,arguments)}C(K,vs.ui.svg.SvgVis);
var L=u.extend({},vs.ui.VisHandler.Settings,{xField:vs.ui.Setting.PredefinedSettings.xField,yField:vs.ui.Setting.PredefinedSettings.yField,xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries,yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries,xScale:vs.ui.Setting.PredefinedSettings.xScale,yScale:vs.ui.Setting.PredefinedSettings.yScale,cols:vs.ui.Setting.PredefinedSettings.cols,itemRatio:new vs.ui.Setting({key:"itemRatio",type:vs.ui.Setting.Type.NUMBER,defaultValue:.015,label:"item ratio",
template:"_slider.html",possibleValues:{min:.001,max:.1,step:.001}}),fills:vs.ui.Setting.PredefinedSettings.fills,fillOpacity:vs.ui.Setting.PredefinedSettings.fillOpacity,strokes:vs.ui.Setting.PredefinedSettings.strokes,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness,interpolation:new vs.ui.Setting({key:"interpolation",
type:vs.ui.Setting.Type.STRING,defaultValue:"linear"})});Object.defineProperties(K.prototype,{settings:{get:function(){return L}}});
K.prototype.endDraw=function(){var b=this,g=arguments;return(new Promise(function(g){var a=b.data,k=b.optionValue("cols"),a=a.filter(function(a){return 0<=k.indexOf(a.id)});if(a.length&&vs.models.DataSource.allDataIsReady(a)){var d=b.optionValue("margins"),f=b.a("xScale"),c=b.a("yScale"),e=b.optionValue("xField"),w=b.optionValue("yField"),p=b.a("fills"),l=b.optionValue("fillOpacity"),m=b.a("strokes"),t=b.optionValue("strokeThickness"),n=b.optionValue("itemRatio"),q=b.optionValue("width"),r=b.optionValue("height"),
r=Math.min(Math.abs(q),Math.abs(r))*n,v=d3.select(b.$element[0]).select("svg"),q=b.optionValue("interpolation"),n=v.select(".viewport");n.empty()&&(n=v.append("g").attr("class","viewport"));n.attr("transform","translate("+d.left+", "+d.top+")");var v=u.fast.concat(u.fast.map(a,function(a){return a.d})),d=n.selectAll("circle").data(v,M(b)),x=u.mapToObject(b.data,function(a){return{key:a.id,value:a}});d.enter().append("circle").attr("class","vs-item").on("mouseover",function(a){a&&b.brushing.fire(new vs.ui.BrushingEvent(x[a.__d__],
vs.ui.BrushingEvent.Action.MOUSEOVER,a))}).on("mouseout",function(a){a&&b.brushing.fire(new vs.ui.BrushingEvent(x[a.__d__],vs.ui.BrushingEvent.Action.MOUSEOUT,a))}).on("click",function(){d3.event.stopPropagation()});d.attr("r",r).attr("cx",function(a){return f(parseFloat(a[e]))}).attr("cy",function(a){return c(parseFloat(a[w]))}).style("fill",function(a){return u.hex2rgba(p(a.__d__),l)}).style("stroke",function(a){return m([a.__d__])}).style("stroke-width",t).style("opacity",0);r=n.selectAll(".coords").data(v,
M(b));r.enter().append("text").attr("class","coords");r.attr("x",function(a){return 9+f(parseFloat(a[e]))}).attr("y",function(a){return-9+c(parseFloat(a[w]))}).attr("background","blue").attr("dy",".35em").attr("opacity",0);q=d3.svg.line().x(function(a){return f(parseFloat(a[e]))}).y(function(a){return c(parseFloat(a[w]))}).interpolate(q);n=n.selectAll(".line").data(a.map(function(a){return a.d}));n.enter().append("path").attr("class","line");n.attr("d",q).attr("stroke",function(b,c){return p(a[c].id)}).attr("stroke-width",
t).attr("fill","none");d.exit().remove()}g()})).then(function(){return vs.ui.svg.SvgVis.prototype.endDraw.apply(b,g)})};
K.prototype.highlightItem=function(b,g){var h=this.optionValue("xField"),a=this.optionValue("yField"),k=d3.select(this.$element[0]).select("svg").select(".viewport");if(!k.empty()&&g.length){var d=M(this),f=u.mapToObject(g,function(a){return{key:d(a),value:!0}}),c=k.selectAll(".vs-item").filter(function(a){return d(a)in f}),e=k.selectAll(".coords").filter(function(a){return d(a)in f});if(!c.empty()){var w=this.optionValue("selectFill"),p=this.optionValue("selectStroke"),l=this.optionValue("selectStrokeThickness");
c.style("opacity",1).style("stroke",p).style("stroke-width",l).style("fill",w);e.text(function(b){return parseFloat(b[h]).toFixed(2)+", "+parseFloat(b[a]).toFixed(2)}).attr("opacity",1);$(c[0]).appendTo($(k[0]))}}};
K.prototype.unhighlightItem=function(b,g){var h=d3.select(this.$element[0]).select("svg").select(".viewport");if(!h.empty()){var a=M(this),k=u.mapToObject(g,function(b){return{key:a(b),value:!0}}),d=h.selectAll(".vs-item").filter(function(b){return a(b)in k}),h=h.selectAll(".coords").filter(function(b){return a(b)in k});d.empty()||(this.a("fills"),this.a("strokes"),this.optionValue("fillOpacity"),this.optionValue("strokeThickness"),d.style("opacity",0),h.attr("opacity",0))}};
function M(b){var g=b.optionValue("xField");return function(b){return b.__d__+"-"+b[g]}};vs.ui.plugins.svg.f=function(){function b(){vs.ui.svg.SvgVis.apply(this,arguments);this[g]=null;var a=this;this.$scope.$watch(function(){return{dataSources:a.options.dataSources,xVal:a.options.xVal,mergeFields:a.options.mergeFields}},function(){a.schedulePreProcessData().then(function(){a.scheduleRedraw()})},!0)}var g=Symbol("_merged"),h=Symbol("_key");C(b,vs.ui.svg.SvgVis);b.a=u.extend({},vs.ui.VisHandler.Settings,{mergeField:new vs.ui.Setting({key:"mergeField",type:vs.ui.Setting.Type.DATA_ROW_LABEL,
defaultValue:vs.ui.Setting.firstRowsLabel,label:"merge field",template:"_categorical.html"}),valueField:vs.ui.Setting.PredefinedSettings.yField.copy({key:"valueField",label:"value field"}),mergeFields:vs.ui.Setting.PredefinedSettings.mergeCols.copy({key:"mergeFields",dependencies:{xCol:"mergeField"}}),xScale:vs.ui.Setting.PredefinedSettings.xScale,yScale:vs.ui.Setting.PredefinedSettings.yScale,xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries.copy({dependencies:{xField:"valueField"}}),yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries.copy({dependencies:{yField:"valueField"}}),
dataSources:vs.ui.Setting.PredefinedSettings.cols.copy({key:"dataSources",label:"data sources",defaultValue:function(a,b,d,f){return u.fast.map(f,function(a){return a.id})}}),fill:vs.ui.Setting.PredefinedSettings.fill,stroke:vs.ui.Setting.PredefinedSettings.stroke,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});
Object.defineProperties(b.prototype,{settings:{get:function(){return b.a}}});b.prototype.endDraw=function(){var a=this,b=arguments;return(new Promise(function(b){var f=a[g];if(f&&f.d.length){var c=a.optionValue("margins"),e=a.optionValue("dataSources"),k=a.optionValue("valueField"),p=a.optionValue("width"),l=a.optionValue("height"),m=a.optionValue("yBoundaries"),t=a.optionValue("fill"),t=u.toHexAlpha(t),n=d3.scale.linear().domain([0,f.d.length]).range([0,p-c.left-c.right]),q=d3.scale.linear().domain([0,
e.length]).range([0,l-c.top-c.bottom]),r=d3.scale.linear().domain([m.min,m.max]).range(["#ffffff",t.hex]),l=d3.select(a.$element[0]).select("svg"),p=l.select(".viewport");p.empty()&&(p=l.append("g").attr("class","viewport"));p.attr("transform","translate("+c.left+", "+c.top+")");var l=u.fast.concat(u.fast.map(f.d,function(a){return u.fast.map(e,function(b){return a[b]})})),v=u.mapToObject(a.data,function(a){return{key:a.id,value:a}}),f=n(1),c=q(1),p=p.selectAll("rect").data(l,a[h]());p.enter().append("rect").attr("class",
"vs-item").on("mouseover",function(b){b&&a.brushing.fire(new vs.ui.BrushingEvent(v[b.__d__],vs.ui.BrushingEvent.Action.MOUSEOVER,b))}).on("mouseout",function(b){b&&a.brushing.fire(new vs.ui.BrushingEvent(v[b.__d__],vs.ui.BrushingEvent.Action.MOUSEOUT,b))}).on("click",function(){d3.event.stopPropagation()});p.attr("x",function(a,b){return n(Math.floor(b/e.length))}).attr("y",function(a,b){return q(b%e.length)}).attr("width",f).attr("height",c).attr("fill",function(a){return a?r(a[k]):"#aaaaaa"}).attr("fill-opacity",
t.alpha);p.exit().remove()}b()})).then(function(){return vs.ui.svg.SvgVis.prototype.endDraw.apply(a,b)})};b.prototype.highlightItem=function(a,b){var d=d3.select(this.$element[0]).select("svg").select(".viewport");if(!d.empty()&&b.length){var f=this[h](),c=u.mapToObject(b,function(a){return{key:f(a),value:!0}}),d=d.selectAll(".vs-item").filter(function(a){return f(a)in c});if(!d.empty()){var e=this.optionValue("selectFill");this.optionValue("selectStroke");this.optionValue("selectStrokeThickness");
var g=this.optionValue("yBoundaries"),p=this.optionValue("valueField"),e=u.toHexAlpha(e),l=d3.scale.linear().domain([g.min,g.max]).range(["#ffffff",e.hex]);d.attr("fill",function(a){return l(a[p])}).attr("fill-opacity",e.alpha)}}};b.prototype.unhighlightItem=function(a,b){var d=d3.select(this.$element[0]).select("svg").select(".viewport");if(!d.empty()){var f=this[h](),c=u.mapToObject(b,function(a){return{key:f(a),value:!0}}),d=d.selectAll(".vs-item").filter(function(a){return f(a)in c});if(!d.empty()){var e=
this.optionValue("fill"),g=this.optionValue("yBoundaries"),p=this.optionValue("valueField"),e=u.toHexAlpha(e),l=d3.scale.linear().domain([g.min,g.max]).range(["#ffffff",e.hex]);d.attr("fill",function(a){return l(a[p])}).attr("fill-opacity",e.alpha)}}};b.prototype.preProcessData=function(){var a=this;return new Promise(function(b){Promise.all(u.fast.map(a.data,function(a){return a.ready})).then(function(){var d=a.optionValue("dataSources"),f=a.optionValue("mergeField"),d=u.fast.map(d,function(b){return a.data[u.array.indexOf(a.data,
function(a){return a.id==b})]});1>d.length&&(a[g]=null,b());1==d.length&&(a[g]=d[0],b());var c=a.optionValue("mergeFields");a[g]=c(f,d);b()})})};b.prototype[h]=function(){var a=this.optionValue("mergeField");return function(b,d){return void 0==b?d:b.__d__+"-"+b[a]}};return b}();z("vs.ui.plugins.canvas.ManhattanPlot",vs.ui.plugins.canvas.i);vs.ui.plugins.canvas.i.prototype.endDraw=vs.ui.plugins.canvas.i.prototype.endDraw;vs.ui.plugins.canvas.i.prototype.getItemsAt=vs.ui.plugins.canvas.i.prototype.getItemsAt;vs.ui.plugins.canvas.i.prototype.highlightItem=vs.ui.plugins.canvas.i.prototype.highlightItem;z("vs.ui.plugins.canvas.ScatterPlot",vs.ui.plugins.canvas.c);vs.ui.plugins.canvas.c.prototype.endDraw=vs.ui.plugins.canvas.c.prototype.endDraw;vs.ui.plugins.canvas.c.prototype.getItemsAt=vs.ui.plugins.canvas.c.prototype.getItemsAt;vs.ui.plugins.canvas.c.prototype.highlightItem=vs.ui.plugins.canvas.c.prototype.highlightItem;vs.ui.plugins.canvas.c.prototype.preProcessData=vs.ui.plugins.canvas.c.prototype.preProcessData;z("vs.ui.plugins.svg.Heatmap",vs.ui.plugins.svg.f);vs.ui.plugins.svg.f.prototype.endDraw=vs.ui.plugins.svg.f.prototype.endDraw;vs.ui.plugins.svg.f.prototype.highlightItem=vs.ui.plugins.svg.f.prototype.highlightItem;vs.ui.plugins.svg.f.prototype.unhighlightItem=vs.ui.plugins.svg.f.prototype.unhighlightItem;vs.ui.plugins.svg.f.prototype.preProcessData=vs.ui.plugins.svg.f.prototype.preProcessData;z("vs.ui.plugins.svg.Line",K);K.prototype.endDraw=K.prototype.endDraw;K.prototype.highlightItem=K.prototype.highlightItem;K.prototype.unhighlightItem=K.prototype.unhighlightItem;z("vs.ui.plugins.svg.ManhattanPlot",D);D.prototype.endDraw=D.prototype.endDraw;D.prototype.highlightItem=D.prototype.highlightItem;D.prototype.unhighlightItem=D.prototype.unhighlightItem;z("vs.ui.plugins.svg.ScatterPlot",vs.ui.plugins.svg.c);vs.ui.plugins.svg.c.prototype.endDraw=vs.ui.plugins.svg.c.prototype.endDraw;vs.ui.plugins.svg.c.prototype.highlightItem=vs.ui.plugins.svg.c.prototype.highlightItem;vs.ui.plugins.svg.c.prototype.unhighlightItem=vs.ui.plugins.svg.c.prototype.unhighlightItem;vs.ui.plugins.svg.c.prototype.preProcessData=vs.ui.plugins.svg.c.prototype.preProcessData;}).call(this); //@ sourceMappingURL=vs.ui.plugins.min.js.map
