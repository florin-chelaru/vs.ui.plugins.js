(function(){/*
 vs.ui.plugins.js
 Copyright (c) 2015 Florin Chelaru
 License: MIT

 Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to
 permit persons to whom the Software is furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
'use strict';var x=this;Math.random();function C(b,g){var c=b.split("."),a=x;c[0]in a||!a.execScript||a.execScript("var "+c[0]);for(var v;c.length&&(v=c.shift());)c.length||void 0===g?a[v]?a=a[v]:a=a[v]={}:a[v]=g}function D(b,g){function c(){}c.prototype=g.prototype;b.B=g.prototype;b.prototype=new c;b.prototype.constructor=b;b.v=function(a,c,h){for(var e=Array(arguments.length-2),d=2;d<arguments.length;d++)e[d-2]=arguments[d];return g.prototype[c].apply(a,e)}};var vs={ui:{}};u.extend(vs,this.vs);u.extend(vs.ui,this.vs.ui);vs.ui.plugins={};vs.ui.plugins.svg={};function G(){vs.ui.svg.SvgVis.apply(this,arguments)}D(G,vs.ui.svg.SvgVis);
var I=u.extend({},vs.ui.VisHandler.Settings,{xField:vs.ui.Setting.PredefinedSettings.xField,yField:vs.ui.Setting.PredefinedSettings.yField,xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries,yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries,xScale:vs.ui.Setting.PredefinedSettings.xScale,yScale:vs.ui.Setting.PredefinedSettings.yScale,cols:vs.ui.Setting.PredefinedSettings.cols,itemRatio:new vs.ui.Setting({key:"itemRatio",type:vs.ui.Setting.Type.NUMBER,defaultValue:.015,label:"item ratio",
template:"_slider.html",possibleValues:{min:.001,max:.1,step:.001}}),fills:vs.ui.Setting.PredefinedSettings.fills,fillOpacity:vs.ui.Setting.PredefinedSettings.fillOpacity,strokes:vs.ui.Setting.PredefinedSettings.strokes,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});
Object.defineProperties(G.prototype,{settings:{get:function(){return I}}});
G.prototype.endDraw=function(){var b=this,g=arguments;return(new Promise(function(c){var a=b.data,v=b.optionValue("cols"),a=a.filter(function(a){return 0<=v.indexOf(a.id)});if(a.length&&vs.models.DataSource.allDataIsReady(a)){var h=b.optionValue("margins"),e=b.c("xScale"),d=b.c("yScale"),f=b.optionValue("xField"),w=b.optionValue("yField"),m=b.c("fills"),k=b.optionValue("fillOpacity"),l=b.c("strokes"),n=b.optionValue("strokeThickness"),g=b.optionValue("itemRatio"),p=b.optionValue("width"),q=b.optionValue("height"),
g=Math.min(Math.abs(p),Math.abs(q))*g,q=d3.select(b.$element[0]).select("svg"),p=q.select(".viewport");p.empty()&&(p=q.append("g").attr("class","viewport"));p.attr("transform","translate("+h.left+", "+h.top+")");var a=u.fast.concat(u.fast.map(a,function(a){return a.d})),a=p.selectAll("circle").data(a,J(b)),t=u.mapToObject(b.data,function(a){return{key:a.id,value:a}});a.enter().append("circle").attr("class","vs-item").on("mouseover",function(a){a&&b.brushing.fire(new vs.ui.BrushingEvent(t[a.__d__],
vs.ui.BrushingEvent.Action.MOUSEOVER,a))}).on("mouseout",function(a){a&&b.brushing.fire(new vs.ui.BrushingEvent(t[a.__d__],vs.ui.BrushingEvent.Action.MOUSEOUT,a))}).on("click",function(){d3.event.stopPropagation()});a.attr("r",g).attr("cx",function(a){return e(parseFloat(a[f]))}).attr("cy",function(a){return d(parseFloat(a[w]))}).style("fill",function(a){return u.hex2rgba(m(a.__d__),k)}).style("stroke",function(a){return l([a.__d__])}).style("stroke-width",n);a.exit().remove()}c()})).then(function(){return vs.ui.svg.SvgVis.prototype.endDraw.apply(b,
g)})};G.prototype.highlightItem=function(b,g){var c=d3.select(this.$element[0]).select("svg").select(".viewport");if(!c.empty()&&g.length){var a=J(this),v=u.mapToObject(g,function(c){return{key:a(c),value:!0}}),h=c.selectAll(".vs-item").filter(function(c){return a(c)in v});if(!h.empty()){var e=this.optionValue("selectFill"),d=this.optionValue("selectStroke"),f=this.optionValue("selectStrokeThickness");h.style("stroke",d).style("stroke-width",f).style("fill",e);$(h[0]).appendTo($(c[0]))}}};
G.prototype.unhighlightItem=function(b,g){var c=d3.select(this.$element[0]).select("svg").select(".viewport");if(!c.empty()){var a=J(this),v=u.mapToObject(g,function(c){return{key:a(c),value:!0}}),c=c.selectAll(".vs-item").filter(function(c){return a(c)in v});if(!c.empty()){var h=this.c("fills"),e=this.c("strokes"),d=this.optionValue("fillOpacity"),f=this.optionValue("strokeThickness");c.style("fill",function(a){return u.hex2rgba(h(a.__d__),d)}).style("stroke",function(a){return e([a.__d__])}).style("stroke-width",
f)}}};function J(b){var g=b.optionValue("xField");return function(c){return c.__d__+"-"+c[g]}};vs.ui.plugins.canvas={};
vs.ui.plugins.canvas.i=function(){function b(){vs.ui.canvas.CanvasVis.apply(this,arguments);this[g]=null}var g=Symbol("_quadTree");D(b,vs.ui.canvas.CanvasVis);b.c=u.extend({},vs.ui.canvas.CanvasVis.Settings,{xVal:vs.ui.Setting.PredefinedSettings.xVal,yVal:vs.ui.Setting.PredefinedSettings.yVal,xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries,yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries,xScale:vs.ui.Setting.PredefinedSettings.xScale,yScale:vs.ui.Setting.PredefinedSettings.yScale,cols:vs.ui.Setting.PredefinedSettings.cols,
itemRatio:new vs.ui.Setting({key:"itemRatio",type:vs.ui.Setting.Type.NUMBER,defaultValue:.015,label:"item ratio",template:"_number.html"}),fills:vs.ui.Setting.PredefinedSettings.fills,fillOpacity:vs.ui.Setting.PredefinedSettings.fillOpacity,strokes:vs.ui.Setting.PredefinedSettings.strokes,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});
Object.defineProperties(b.prototype,{settings:{get:function(){return b.c}}});b.prototype.beginDraw=function(){var c=this,a=arguments;return new Promise(function(b){vs.ui.canvas.CanvasVis.prototype.beginDraw.apply(c,a).then(function(){var a=c.data,e=c.optionValue("cols"),a=a.filter(function(a){return 0<=e.indexOf(a.id)});if(a.length&&vs.models.DataSource.allDataIsReady(a)){for(var d=c.optionValue("margins"),f=c.optionValue("xScale"),w=c.optionValue("yScale"),m=c.optionValue("xVal"),k=c.optionValue("yVal"),
l=c.optionValue("itemRatio"),n=c.optionValue("width"),r=c.optionValue("height"),p=Math.min(Math.abs(n),Math.abs(r))*l,l=new u.QuadTree(d.left,d.top,n-d.left-d.right,r-d.top-d.bottom,l,10),d=vs.models.Transformer.scale(f,w).translate({x:d.left,y:d.top}),a=u.fast.concat(u.fast.map(a,function(a){return a.d})),f=0;f<a.length;++f)w=a[f],n=d.calc({x:parseFloat(w[m]),y:parseFloat(w[k])}),l.insert(n.x-p,n.y-p,2*p,2*p,w);c[g]=l}b()})})};b.prototype.endDraw=function(){var c=this,a=arguments;return(new Promise(function(a,
h){var e=c.optionValue("cols"),d=c.data.filter(function(a){return 0<=e.indexOf(a.id)});if(d.length&&vs.models.DataSource.allDataIsReady(d)){var b=c.optionValue("margins"),w=c.optionValue("xScale"),m=c.optionValue("yScale"),k=c.optionValue("xVal"),l=c.optionValue("yVal"),n=c.optionValue("itemRatio"),g=c.optionValue("width"),p=c.optionValue("height"),q=Math.min(Math.abs(g),Math.abs(p))*n,t=c.optionValue("fills"),y=c.optionValue("fillOpacity"),z=c.optionValue("strokes"),A=c.optionValue("strokeThickness"),
E=c.pendingCanvas[0].getContext("2d"),B=vs.models.Transformer.scale(w,m).translate({x:b.left,y:b.top}),d=u.fast.concat(u.fast.map(d,function(a){return a.d}));u.async.each(d,function(a){return new Promise(function(c){setTimeout(function(){var d=B.calc({x:parseFloat(a[k]),y:parseFloat(a[l])});vs.ui.canvas.CanvasVis.circle(E,d.x,d.y,q,u.hex2rgba(t(a.__d__),y),z(a.__d__),A);c()},0)})}).then(a,h)}else a()})).then(function(){return vs.ui.canvas.CanvasVis.prototype.endDraw.apply(c,a)})};b.prototype.getItemsAt=
function(c,a){return this[g]?u.fast.map(this[g].collisions(c,a),function(a){return a.value}):[]};b.prototype.highlightItem=function(c,a){if(this.brushingCanvas&&a.length){var b=this.optionValue("margins"),h=this.optionValue("xScale"),e=this.optionValue("yScale"),d=this.optionValue("cols"),f=this.optionValue("xVal"),w=this.optionValue("yVal"),g=this.optionValue("itemRatio"),k=this.optionValue("width"),l=this.optionValue("height"),g=Math.min(Math.abs(k),Math.abs(l))*g,n=this.optionValue("selectFill"),
r=this.optionValue("selectStroke"),p=this.optionValue("selectStrokeThickness"),q=u.mapToObject(d,function(a){return{key:a,value:!0}});a=a.filter(function(a){return a.__d__ in q});b=vs.models.Transformer.scale(h,e).translate({x:b.left,y:b.top});h=this.brushingCanvas[0].getContext("2d");this.brushingCanvas.attr({width:k,height:l});for(k=0;k<a.length;++k)l=a[k],l=b.calc({x:parseFloat(l[f]),y:l[w]}),vs.ui.canvas.CanvasVis.circle(h,l.x,l.y,g,n,r,p);this.brushingCanvas.css("display","block")}};b.prototype.unhighlightItem=
function(){this.brushingCanvas.css("display","none");var c=this.optionValue("width"),a=this.optionValue("height");this.brushingCanvas[0].getContext("2d").clearRect(0,0,c,a)};return b}();vs.ui.plugins.canvas.a=function(){function b(){vs.ui.canvas.CanvasVis.apply(this,arguments);this[c]=null;this[g]=null;var a=this;this.$scope.$watch(function(){return{xyFields:a.options.xyFields,mergeField:a.options.mergeField,mergeCols:a.options.mergeCols}},function(){a.schedulePreProcessData().then(function(){a.scheduleRedraw()})},!0)}var g=Symbol("_quadTree"),c=Symbol("_merged");D(b,vs.ui.canvas.CanvasVis);b.A=function(a,c,b,e){var d=["yBoundaries","width","margins"];if(!e)throw new vs.ui.UiException('Settings not provided for "xScale", which depends on '+
JSON.stringify(d));u.fast.forEach(d,function(a){if(!(a in e))throw new vs.ui.UiException('Missing dependency for "'+a+'" in the "xScale" defaultValue function');});var d=e.yBoundaries.getValue(a,c,b,e),f=e.width.getValue(a,c,b,e);a=e.margins.getValue(a,c,b,e);return d3.scale.linear().domain([d.min,d.max]).range([0,f-a.left-a.right])};b.c=u.extend({},vs.ui.canvas.CanvasVis.Settings,{mergeField:new vs.ui.Setting({key:"mergeField",type:vs.ui.Setting.Type.DATA_ROW_LABEL,defaultValue:vs.ui.Setting.firstRowsLabel,
label:"merge field",template:"_categorical.html"}),valueField:vs.ui.Setting.PredefinedSettings.yField.copy({key:"valueField",label:"value field"}),xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries.copy({dependencies:{xField:"valueField"}}),yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries.copy({dependencies:{yField:"valueField"}}),xScale:vs.ui.Setting.PredefinedSettings.xScale,yScale:vs.ui.Setting.PredefinedSettings.yScale,xyFields:vs.ui.Setting.PredefinedSettings.cols.copy({key:"xyFields",
label:"x/y fields",defaultValue:function(a,c,b,e){return u.fast.map(e.slice(0,2),function(a){return a.id})}}),xLabel:new vs.ui.Setting({key:"xLabel",type:vs.ui.Setting.Type.STRING,defaultValue:b.j,label:"x label",dependencies:{xyFields:"xyFields"},template:"_string.html"}),yLabel:new vs.ui.Setting({key:"yLabel",type:vs.ui.Setting.Type.STRING,defaultValue:b.o,label:"y label",dependencies:{xyFields:"xyFields"},template:"_string.html"}),mergeFields:vs.ui.Setting.PredefinedSettings.mergeCols.copy({key:"mergeFields",
dependencies:{xCol:"mergeField"}}),itemRatio:new vs.ui.Setting({key:"itemRatio",type:vs.ui.Setting.Type.NUMBER,defaultValue:.015,label:"item ratio",template:"_slider.html",possibleValues:{min:.001,max:.1,step:.001}}),fill:vs.ui.Setting.PredefinedSettings.fill,stroke:vs.ui.Setting.PredefinedSettings.stroke,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});
Object.defineProperties(b.prototype,{settings:{get:function(){return b.c}}});b.prototype.beginDraw=function(){var a=this,b=arguments;return new Promise(function(h){vs.ui.canvas.CanvasVis.prototype.beginDraw.apply(a,b).then(function(){var b=a[c];if(b&&b.d.length){var d=a.optionValue("xyFields"),f=a.optionValue("margins"),v=a.optionValue("yBoundaries");a.optionValue("mergeField");for(var m=a.optionValue("valueField"),k=a.optionValue("itemRatio"),l=a.optionValue("xScale"),n=a.optionValue("yScale"),r=
a.optionValue("width"),p=a.optionValue("height"),q=Math.min(Math.abs(r),Math.abs(p))*k,t=d[0],d=d[1],k=new u.QuadTree(f.left,f.top,r-f.left-f.right,p-f.top-f.bottom,k,10),f=vs.models.Transformer.scale(l,n).translate({x:f.left,y:f.top}),b=b.d,l=0;l<b.length;++l)n=b[l],r=f.calc({x:void 0!=n[t]?n[t][m]:v.min,y:void 0!=n[d]?n[d][m]:v.min}),k.insert(r.x-q,r.y-q,2*q,2*q,n);a[g]=k}h()})})};b.prototype.endDraw=function(){var a=this,b=arguments;return(new Promise(function(b,e){var d=a[c];if(d&&d.d.length){var f=
a.optionValue("margins"),v=a.optionValue("xScale"),g=a.optionValue("yScale"),k=a.optionValue("xyFields"),l=a.optionValue("yBoundaries");a.optionValue("mergeField");var n=a.optionValue("valueField"),r=a.optionValue("itemRatio"),p=a.optionValue("width"),q=a.optionValue("height"),t=Math.min(Math.abs(p),Math.abs(q))*r,y=k[0],z=k[1],A=a.optionValue("fill"),E=a.optionValue("stroke"),B=a.optionValue("strokeThickness"),F=a.pendingCanvas[0].getContext("2d"),H=vs.models.Transformer.scale(v,g).translate({x:f.left,
y:f.top});u.async.each(d.d,function(a){return new Promise(function(c){setTimeout(function(){var b=H.calc({x:void 0!=a[y]?a[y][n]:l.min,y:void 0!=a[z]?a[z][n]:l.min});vs.ui.canvas.CanvasVis.circle(F,b.x,b.y,t,void 0==a[y]||void 0==a[z]?"rgba(170,170,170,0.5)":A,void 0==a[y]||void 0==a[z]?"rgb(170,170,170)":E,B);c()},0)})}).then(b,e)}else b()})).then(function(){return vs.ui.canvas.CanvasVis.prototype.endDraw.apply(a,b)})};b.prototype.getItemsAt=function(a,c){console.log(a,c);if(!this[g])return[];var b=
this.optionValue("xyFields"),e=b[0],d=b[1];return u.fast.concat(u.fast.map(this[g].collisions(a,c),function(a){var c=[];void 0!=a.value[e]&&c.push(a.value[e]);void 0!=a.value[d]&&c.push(a.value[d]);return c}))};b.prototype.highlightItem=function(a,b){if(this.brushingCanvas&&b.length){var h=this[c];if(h){var e=this.optionValue("mergeField"),d=u.mapToObject(b,function(a){return{key:a[e],value:!0}}),h=u.fast.filter(h.d,function(a){return a[e]in d});if(h.length){var f=this.optionValue("margins"),g=this.optionValue("xScale"),
m=this.optionValue("yScale"),k=this.optionValue("xyFields"),l=this.optionValue("valueField"),n=this.optionValue("itemRatio"),r=this.optionValue("width"),p=this.optionValue("height"),q=this.optionValue("yBoundaries"),t=this.optionValue("selectFill"),y=this.optionValue("selectStroke"),z=this.optionValue("selectStrokeThickness"),A=vs.models.Transformer.scale(g,m).translate({x:f.left,y:f.top}),E=Math.min(Math.abs(r),Math.abs(p))*n,B=k[0],F=k[1],H=this.brushingCanvas[0].getContext("2d");this.brushingCanvas.attr({width:r,
height:p});u.fast.forEach(h,function(a){a=A.calc({x:void 0!=a[B]?a[B][l]:q.min,y:void 0!=a[F]?a[F][l]:q.min});vs.ui.canvas.CanvasVis.circle(H,a.x,a.y,E,t,y,z)});this.brushingCanvas.css("display","block")}}}};b.prototype.unhighlightItem=function(){this.brushingCanvas.css("display","none");var a=this.optionValue("width"),c=this.optionValue("height");this.brushingCanvas[0].getContext("2d").clearRect(0,0,a,c)};b.prototype.preProcessData=function(){var a=this;return new Promise(function(b,h){Promise.all(u.fast.map(a.data,
function(a){return a.ready})).then(function(){var e=a.optionValue("xyFields"),d=a.optionValue("mergeField"),f=u.fast.map(e,function(c){return a.data[u.array.indexOf(a.data,function(a){return a.id==c})]});2>f.length?h("Scatter plot needs two columns of data, but only received "+e.length):(e=a.optionValue("mergeFields"),a[c]=e(d,f),b())})})};return b}();vs.ui.plugins.svg.a=function(){function b(){vs.ui.svg.SvgVis.apply(this,arguments);this[g]=null;var c=this;this.$scope.$watch(function(){return{cols:c.options.cols,mergeField:c.options.mergeField,mergeFields:c.options.mergeFields}},function(){c.schedulePreProcessData().then(function(){c.scheduleRedraw()})},!0)}var g=Symbol("_merged");D(b,vs.ui.svg.SvgVis);b.j=function(c,a,b,h,e){var d=c.dependencies;if(!e)throw new vs.ui.UiException('Settings not provided for "'+c.key+'", which depends on '+JSON.stringify(d));
u.each(d,function(a,c){if(!(c in e))throw new vs.ui.UiException('Missing dependency for "'+c+'" in the "xLabel" defaultValue function');});return e[d.xyFields].getValue(a,b,h,e)[0]};b.o=function(c,a,b,h,e){var d=c.dependencies;if(!e)throw new vs.ui.UiException('Settings not provided for "'+c.key+'", which depends on '+JSON.stringify(d));u.each(d,function(a,c){if(!(c in e))throw new vs.ui.UiException('Missing dependency for "'+c+'" in the "xLabel" defaultValue function');});return e[d.xyFields].getValue(a,
b,h,e)[1]};b.c=u.extend({},vs.ui.VisHandler.Settings,{mergeField:new vs.ui.Setting({key:"mergeField",type:vs.ui.Setting.Type.DATA_ROW_LABEL,defaultValue:vs.ui.Setting.firstRowsLabel,label:"merge field",template:"_categorical.html"}),valueField:vs.ui.Setting.PredefinedSettings.yField.copy({key:"valueField",label:"value field"}),xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries.copy({dependencies:{xField:"valueField"}}),yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries.copy({dependencies:{yField:"valueField"}}),
xScale:vs.ui.Setting.PredefinedSettings.xScale,yScale:vs.ui.Setting.PredefinedSettings.yScale,xyFields:vs.ui.Setting.PredefinedSettings.cols.copy({key:"xyFields",label:"x/y fields",defaultValue:function(c,a,b,h){return u.fast.map(h.slice(0,2),function(a){return a.id})}}),xLabel:new vs.ui.Setting({key:"xLabel",type:vs.ui.Setting.Type.STRING,defaultValue:b.j,label:"x label",dependencies:{xyFields:"xyFields"},template:"_string.html"}),yLabel:new vs.ui.Setting({key:"yLabel",type:vs.ui.Setting.Type.STRING,
defaultValue:b.o,label:"y label",dependencies:{xyFields:"xyFields"},template:"_string.html"}),mergeFields:vs.ui.Setting.PredefinedSettings.mergeCols.copy({key:"mergeFields",dependencies:{xCol:"mergeField"}}),itemRatio:new vs.ui.Setting({key:"itemRatio",type:vs.ui.Setting.Type.NUMBER,defaultValue:.015,label:"item ratio",template:"_slider.html",possibleValues:{min:.001,max:.1,step:.001}}),fill:vs.ui.Setting.PredefinedSettings.fill,stroke:vs.ui.Setting.PredefinedSettings.stroke,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,
selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});Object.defineProperties(b.prototype,{settings:{get:function(){return b.c}}});b.prototype.endDraw=function(){var c=this,a=arguments;return(new Promise(function(a){var b=c[g];if(b&&b.d.length){var e=c.optionValue("xyFields"),d=e[0],f=e[1],w=c.optionValue("margins"),m=c.optionValue("yBoundaries"),k=c.c("xScale"),
l=c.c("yScale"),n=c.optionValue("mergeField"),r=c.optionValue("valueField"),p=c.optionValue("itemRatio"),q=c.optionValue("width"),t=c.optionValue("height"),y=c.optionValue("fill"),z=c.optionValue("stroke"),e=c.optionValue("strokeThickness"),p=Math.min(Math.abs(q),Math.abs(t))*p,t=d3.select(c.$element[0]).select("svg"),q=t.select(".viewport");q.empty()&&(q=t.append("g").attr("class","viewport"));q.attr("transform","translate("+w.left+", "+w.top+")");var b=b.d,b=q.selectAll("circle").data(b,function(a){return a[n]}),
A=u.mapToObject(c.data,function(a){return{key:a.id,value:a}});b.enter().append("circle").attr("class","vs-item").on("mouseover",function(a){a[d]&&c.brushing.fire(new vs.ui.BrushingEvent(A[d],vs.ui.BrushingEvent.Action.MOUSEOVER,a[d]));a[f]&&c.brushing.fire(new vs.ui.BrushingEvent(A[f],vs.ui.BrushingEvent.Action.MOUSEOVER,a[f]))}).on("mouseout",function(a){a[d]&&c.brushing.fire(new vs.ui.BrushingEvent(A[d],vs.ui.BrushingEvent.Action.MOUSEOUT,a[d]));a[f]&&c.brushing.fire(new vs.ui.BrushingEvent(A[f],
vs.ui.BrushingEvent.Action.MOUSEOUT,a[f]))}).on("click",function(){d3.event.stopPropagation()});b.attr("r",p).attr("cx",function(a){return k(void 0!=a[d]?a[d][r]:m.min)}).attr("cy",function(a){return l(void 0!=a[f]?a[f][r]:m.min)}).style("fill",function(a){return void 0==a[d]||void 0==a[f]?"rgba(170,170,170,0.5)":y}).style("stroke",function(a){return void 0==a[d]||void 0==a[f]?"rgb(170,170,170)":z}).style("stroke-width",e);b.exit().remove()}a()})).then(function(){return vs.ui.svg.SvgVis.prototype.endDraw.apply(c,
a)})};b.prototype.highlightItem=function(c,a){var b=d3.select(this.$element[0]).select("svg").select(".viewport");if(!b.empty()&&a.length){var h=this.optionValue("mergeField"),e=u.mapToObject(a,function(a){return{key:a[h],value:!0}}),d=b.selectAll(".vs-item").filter(function(a){return a[h]in e});if(!d.empty()){var f=this.optionValue("selectFill"),g=this.optionValue("selectStroke"),m=this.optionValue("selectStrokeThickness");d.style("fill",f).style("stroke",g).style("stroke-width",m);$(d[0]).appendTo($(b))}}};
b.prototype.unhighlightItem=function(c,a){var b=d3.select(this.$element[0]).select("svg").select(".viewport");if(!b.empty()){var h=this.optionValue("mergeField"),e=u.mapToObject(a,function(a){return{key:a[h],value:!0}}),b=b.selectAll(".vs-item").filter(function(a){return a[h]in e});if(!b.empty()){var d=this.optionValue("fill"),f=this.optionValue("stroke"),g=this.optionValue("strokeThickness"),m=this.optionValue("xyFields"),k=m[0],l=m[1];b.style("stroke-width",g).style("fill",function(a){return void 0==
a[k]||void 0==a[l]?"rgba(170,170,170,0.5)":d}).style("stroke",function(a){return void 0==a[k]||void 0==a[l]?"rgb(170,170,170)":f})}}};b.prototype.preProcessData=function(){var c=this;return new Promise(function(a,b){Promise.all(u.fast.map(c.data,function(a){return a.ready})).then(function(){var h=c.optionValue("xyFields"),e=c.optionValue("mergeField"),d=u.fast.map(h,function(a){return c.data[u.array.indexOf(c.data,function(b){return b.id==a})]});2>d.length?b("Scatter plot needs two columns of data, but only received "+
h.length):(h=c.optionValue("mergeFields"),c[g]=h(e,d),a())})})};return b}();vs.ui.plugins.svg.f=function(){function b(){vs.ui.svg.SvgVis.apply(this,arguments);this[g]=null;var a=this;this.$scope.$watch(function(){return{dataSources:a.options.dataSources,xVal:a.options.xVal,mergeFields:a.options.mergeFields}},function(){a.schedulePreProcessData().then(function(){a.scheduleRedraw()})},!0)}var g=Symbol("_merged"),c=Symbol("_key");D(b,vs.ui.svg.SvgVis);b.c=u.extend({},vs.ui.VisHandler.Settings,{mergeField:new vs.ui.Setting({key:"mergeField",type:vs.ui.Setting.Type.DATA_ROW_LABEL,
defaultValue:vs.ui.Setting.firstRowsLabel,label:"merge field",template:"_categorical.html"}),valueField:vs.ui.Setting.PredefinedSettings.yField.copy({key:"valueField",label:"value field"}),mergeFields:vs.ui.Setting.PredefinedSettings.mergeCols.copy({key:"mergeFields",dependencies:{xCol:"mergeField"}}),xScale:vs.ui.Setting.PredefinedSettings.xScale,yScale:vs.ui.Setting.PredefinedSettings.yScale,xBoundaries:vs.ui.Setting.PredefinedSettings.xBoundaries.copy({dependencies:{xField:"valueField"}}),yBoundaries:vs.ui.Setting.PredefinedSettings.yBoundaries.copy({dependencies:{yField:"valueField"}}),
dataSources:vs.ui.Setting.PredefinedSettings.cols.copy({key:"dataSources",label:"data sources",defaultValue:function(a,b,c,e){return u.fast.map(e,function(a){return a.id})}}),fill:vs.ui.Setting.PredefinedSettings.fill,stroke:vs.ui.Setting.PredefinedSettings.stroke,strokeThickness:vs.ui.Setting.PredefinedSettings.strokeThickness,selectFill:vs.ui.Setting.PredefinedSettings.selectFill,selectStroke:vs.ui.Setting.PredefinedSettings.selectStroke,selectStrokeThickness:vs.ui.Setting.PredefinedSettings.selectStrokeThickness});
Object.defineProperties(b.prototype,{settings:{get:function(){return b.c}}});b.prototype.endDraw=function(){var a=this,b=arguments;return(new Promise(function(b){var e=a[g];if(e&&e.d.length){var d=a.optionValue("margins"),f=a.optionValue("dataSources"),v=a.optionValue("valueField"),m=a.optionValue("width"),k=a.optionValue("height"),l=a.optionValue("yBoundaries"),n=a.optionValue("fill"),n=u.toHexAlpha(n),r=d3.scale.linear().domain([0,e.d.length]).range([0,m-d.left-d.right]),p=d3.scale.linear().domain([0,
f.length]).range([0,k-d.top-d.bottom]),q=d3.scale.linear().domain([l.min,l.max]).range(["#ffffff",n.hex]),k=d3.select(a.$element[0]).select("svg"),m=k.select(".viewport");m.empty()&&(m=k.append("g").attr("class","viewport"));m.attr("transform","translate("+d.left+", "+d.top+")");var k=u.fast.concat(u.fast.map(e.d,function(a){return u.fast.map(f,function(b){return a[b]})})),t=u.mapToObject(a.data,function(a){return{key:a.id,value:a}}),e=r(1),d=p(1),m=m.selectAll("rect").data(k,a[c]());m.enter().append("rect").attr("class",
"vs-item").on("mouseover",function(b){b&&a.brushing.fire(new vs.ui.BrushingEvent(t[b.__d__],vs.ui.BrushingEvent.Action.MOUSEOVER,b))}).on("mouseout",function(b){b&&a.brushing.fire(new vs.ui.BrushingEvent(t[b.__d__],vs.ui.BrushingEvent.Action.MOUSEOUT,b))}).on("click",function(){d3.event.stopPropagation()});m.attr("x",function(a,b){return r(Math.floor(b/f.length))}).attr("y",function(a,b){return p(b%f.length)}).attr("width",e).attr("height",d).attr("fill",function(a){return a?q(a[v]):"#aaaaaa"}).attr("fill-opacity",
n.alpha);m.exit().remove()}b()})).then(function(){return vs.ui.svg.SvgVis.prototype.endDraw.apply(a,b)})};b.prototype.highlightItem=function(a,b){var h=d3.select(this.$element[0]).select("svg").select(".viewport");if(!h.empty()&&b.length){var e=this[c](),d=u.mapToObject(b,function(a){return{key:e(a),value:!0}}),h=h.selectAll(".vs-item").filter(function(a){return e(a)in d});if(!h.empty()){var f=this.optionValue("selectFill");this.optionValue("selectStroke");this.optionValue("selectStrokeThickness");
var g=this.optionValue("yBoundaries"),m=this.optionValue("valueField"),f=u.toHexAlpha(f),k=d3.scale.linear().domain([g.min,g.max]).range(["#ffffff",f.hex]);h.attr("fill",function(a){return k(a[m])}).attr("fill-opacity",f.alpha)}}};b.prototype.unhighlightItem=function(a,b){var h=d3.select(this.$element[0]).select("svg").select(".viewport");if(!h.empty()){var e=this[c](),d=u.mapToObject(b,function(a){return{key:e(a),value:!0}}),h=h.selectAll(".vs-item").filter(function(a){return e(a)in d});if(!h.empty()){var f=
this.optionValue("fill"),g=this.optionValue("yBoundaries"),m=this.optionValue("valueField"),f=u.toHexAlpha(f),k=d3.scale.linear().domain([g.min,g.max]).range(["#ffffff",f.hex]);h.attr("fill",function(a){return k(a[m])}).attr("fill-opacity",f.alpha)}}};b.prototype.preProcessData=function(){var a=this;return new Promise(function(b){Promise.all(u.fast.map(a.data,function(a){return a.ready})).then(function(){var c=a.optionValue("dataSources"),e=a.optionValue("mergeField"),c=u.fast.map(c,function(b){return a.data[u.array.indexOf(a.data,
function(a){return a.id==b})]});1>c.length&&(a[g]=null,b());1==c.length&&(a[g]=c[0],b());var d=a.optionValue("mergeFields");a[g]=d(e,c);b()})})};b.prototype[c]=function(){var a=this.optionValue("mergeField");return function(b,c){return void 0==b?c:b.__d__+"-"+b[a]}};return b}();C("vs.ui.plugins.canvas.ManhattanPlot",vs.ui.plugins.canvas.i);vs.ui.plugins.canvas.i.prototype.endDraw=vs.ui.plugins.canvas.i.prototype.endDraw;vs.ui.plugins.canvas.i.prototype.getItemsAt=vs.ui.plugins.canvas.i.prototype.getItemsAt;vs.ui.plugins.canvas.i.prototype.highlightItem=vs.ui.plugins.canvas.i.prototype.highlightItem;C("vs.ui.plugins.canvas.ScatterPlot",vs.ui.plugins.canvas.a);vs.ui.plugins.canvas.a.prototype.endDraw=vs.ui.plugins.canvas.a.prototype.endDraw;vs.ui.plugins.canvas.a.prototype.getItemsAt=vs.ui.plugins.canvas.a.prototype.getItemsAt;vs.ui.plugins.canvas.a.prototype.highlightItem=vs.ui.plugins.canvas.a.prototype.highlightItem;vs.ui.plugins.canvas.a.prototype.preProcessData=vs.ui.plugins.canvas.a.prototype.preProcessData;C("vs.ui.plugins.svg.Heatmap",vs.ui.plugins.svg.f);vs.ui.plugins.svg.f.prototype.endDraw=vs.ui.plugins.svg.f.prototype.endDraw;vs.ui.plugins.svg.f.prototype.highlightItem=vs.ui.plugins.svg.f.prototype.highlightItem;vs.ui.plugins.svg.f.prototype.unhighlightItem=vs.ui.plugins.svg.f.prototype.unhighlightItem;vs.ui.plugins.svg.f.prototype.preProcessData=vs.ui.plugins.svg.f.prototype.preProcessData;C("vs.ui.plugins.svg.ManhattanPlot",G);G.prototype.endDraw=G.prototype.endDraw;G.prototype.highlightItem=G.prototype.highlightItem;G.prototype.unhighlightItem=G.prototype.unhighlightItem;C("vs.ui.plugins.svg.ScatterPlot",vs.ui.plugins.svg.a);vs.ui.plugins.svg.a.prototype.endDraw=vs.ui.plugins.svg.a.prototype.endDraw;vs.ui.plugins.svg.a.prototype.highlightItem=vs.ui.plugins.svg.a.prototype.highlightItem;vs.ui.plugins.svg.a.prototype.unhighlightItem=vs.ui.plugins.svg.a.prototype.unhighlightItem;vs.ui.plugins.svg.a.prototype.preProcessData=vs.ui.plugins.svg.a.prototype.preProcessData;}).call(this); //@ sourceMappingURL=vs.ui.plugins.min.js.map
